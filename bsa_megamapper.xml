<?xml version="1.0"?>
<tool id="BSAtest" name="BSAseq MegaMapper" version="0.0.1">
  <description>The Megason Lab's Bulk Segregant Mapper for Galaxy</description>
  <command interpreter="python">bsaseq_megamapper.py $input1 $input2 $out_file1 $out_file2 $out_file3 $out_file4 $name ${GALAXY_ROOT_DIR} $cutoff $bfilter</command> 
  <inputs>
    <param name="name" type="text" value="YOUR_SAMPLE_NAME_HERE" label="Mutant Name"/>
    <param name="cutoff" type="integer" value="9" label="Lower SNP coverage cutoff" help="integers only."/>
    <param name="bfilter" type="select" label="Calculate AF by using " help="How to calculate allele frequency. Using percentile filtering may sharpen peak profiles but carries the risk of mispredicting the candidate chromosome. Default value = mean.">
      <option value="mean">Mean</option>
      <option value="1">1st percentile</option>
      <option value="2">2nd percentile</option>
      <option value="5">5th percentile</option>
      <option value="10">10th percentile</option>
      <option value="20">20th percentile</option>
      <option value="30">30th percentile</option>
      <option value="40">40th percentile</option>
      <option value="50">50th percentile</option>
      <option value="60">60th percentile</option>
      <option value="70">70th percentile</option>
      <option value="80">80th percentile</option>
    </param>

    <!--param name="percentile" type="integer" value="50" label="Percentile Filter" help="Percentile filtering can help remove noise. Integers only."/-->
    <param name="input1" type="data" format="tabular" label="Mutant Pool SNPs" help="Dataset missing? See TIP below"/>
    <param name="input2" type="data" format="tabular" label="Mutagenesis - Mapping Strain SNPs" help="Dataset missing? See TIP below"/>
  </inputs>

  <outputs>
    <data format="tabular" name="out_file1" />
    <data format="tabular" name="out_file4" />
    <data format="png" name="out_file2" />
    <data format="png" name="out_file3" />
  </outputs>

  <requirements>
    <requirement type="python-module">rpy</requirement>
  </requirements>

  <tests>
   <test>
      <param name="name" type="text" value="no_name" label="Mutant Name"/>
      <param name="cutoff" type="integer" value="9" />
      <param name="percentile" type="integer" value="50"/>
      <param name="input1" value="in1.tabular" ftype="tabular"/>
      <param name="input2" value="in2.tabular" ftype="tabular"/>
      <output name="out_file1" file="critint.txt"/>
      <output name="out_file4" file="critint2.txt"/>
      <output name="out_file2" file="megamap1.png"/>
      <output name="out_file3" file="megamap2.png"/>
   </test>  
  </tests>

  <help>
GALAXY
Goecks, J, Nekrutenko, A, Taylor, J and The Galaxy Team. Galaxy: a comprehensive approach for supporting accessible, reproducible, and transparent computational research in the life sciences. Genome Biol. 2010 Aug 25;11(8):R86.

Blankenberg D, Von Kuster G, Coraor N, Ananda G, Lazarus R, Mangan M, Nekrutenko A, Taylor J. "Galaxy: a web-based genome analysis tool for experimentalists". Current Protocols in Molecular Biology. 2010 Jan; Chapter 19:Unit 19.10.1-21.

Giardine B, Riemer C, Hardison RC, Burhans R, Elnitski L, Shah P, Zhang Y, Blankenberg D, Albert I, Taylor J, Miller W, Kent WJ, Nekrutenko A. "Galaxy: a platform for interactive large-scale genome analysis." Genome Research. 2005 Oct; 15(10):1451-5. 


BEDTools
Quinlan AR and Hall IM, 2010. BEDTools: a flexible suite of utilities for comparing genomic features. Bioinformatics. 26, 6, pp. 841â€“842. 
Dale RK, Pedersen BS, and Quinlan AR. Pybedtools: a flexible Python library for manipulating genomic datasets and annotations. Bioinformatics (2011). doi:10.1093/bioinformatics/btr539 


snpEff and snpSift by Pablo Cingolani (pcingola@users.sourceforge.net)
Cingolani, P. "snpEff: Variant effect prediction", http://snpeff.sourceforge.net, 2012.

MegaMapper by Nikolaus Obholzer (2012)
Rapid positional cloning of zebrafish mutations by linkage and homozygosity mapping using whole-genome sequencing.
Obholzer N, Swinburne IA, Schwab E, Nechiporuk AV, Nicolson T, Megason SG.
Development. 2012 Nov;139(22):4280-90. doi: 10.1242/dev.083931. Epub 2012 Oct 10. PMID: 23052906

  </help>

</tool>


